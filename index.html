<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta http-equiv="X-UA-Compatible" content="ie=edge">
   <title>GH</title>
</head>
<body>
   <input onchange="go(this);" type="file" accept="image/gif, image/jpeg, image/png" style="display: block;float:left;clear:both;">
   <canvas></canvas>
   <script>
   
   function go(file_btn){
      var image = new Image();
      var reader = new FileReader();
      reader.onload = function(e){
         image.src = e.target.result;
      }
      reader.readAsDataURL(file_btn.files[0]);
      image.onload = function() {
         algorithm(image);
      }
   }
   function algorithm(image_data){
      var image = document.createElement('canvas');
      image.width = 180;
      image.height = 180 * (image_data.height / image_data.width);
      var image_context = image.getContext('2d');
      image_context.drawImage(image_data, 0, 0, image.width, image.height);
      var imageData = image_context.getImageData(0, 0, image.width, image.height);
      
      var canvas = document.querySelector("canvas");
      canvas.width = image.width*5;
      canvas.height = image.height*5;
      var context = canvas.getContext("2d");

      var usedIndeces = [];

      function magicWand(index, rgba){
         var index_rgba = [imageData.data[index], imageData.data[index + 1], imageData.data[index + 2], imageData.data[index + 3]];

         var diff = Math.abs(rgba[0] - index_rgba[0]) + Math.abs(rgba[1] - index_rgba[1]) + Math.abs(rgba[2] - index_rgba[2]);

         if(usedIndeces.indexOf(index) <= -1 && diff < 70){
            usedIndeces.push(index);
            x = ((index / 4) % image.width) * 5;
            y = Math.floor((index / 4) / image.width) * 5;

            context.fillStyle = `rgba(${rgba.join(",")})`;
            context.fillRect(x, y, 5, 5);

            if((index + 4) / 4 < image.width){
               magicWand(index+4, rgba);
            }
            if(index > 0){
               magicWand(index-4, rgba);
            }
            if(index - (4 * image.width) >= 0){
               magicWand(index - (4 * image.width), rgba);
            }
            if(index + (4 * image.width) < imageData.data.length){
               magicWand(index + (4 * image.width), rgba);
            }
         }
      }

      for(var index = 0;index < imageData.data.length;index += 4){
         magicWand(index, [imageData.data[index], imageData.data[index + 1], imageData.data[index + 2], imageData.data[index + 3]]);
      }
   }

   </script>
</body>
</html>